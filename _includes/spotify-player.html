<div id="spotify-player-wrapper" role="complementary" aria-label="Spotify playlist">
  <iframe
    id="spotify-embed"
    src="https://open.spotify.com/embed/playlist/4ko0VggVCeSzyeJiEsuRC0?theme=0"
    width="100%"
    height="100%"
    frameborder="0"
    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
    loading="lazy">
  </iframe>
</div>

<script>
(() => {
  const iframe = document.getElementById('spotify-embed');
  if (!iframe) return;

  const PLAYLIST_ID = '4ko0VggVCeSzyeJiEsuRC0';
  const buildSrc = (isLight) => {
    const url = new URL(`https://open.spotify.com/embed/playlist/${PLAYLIST_ID}`);
    url.searchParams.set('theme', isLight ? '1' : '0'); // 1 = light, 0 = dark
    url.searchParams.set('utm_source', 'blog_embed');
    return url.toString();
  };

  const applyTheme = () => {
    const isLight = document.documentElement.getAttribute('data-theme') === 'light';
    const next = buildSrc(isLight);
    if (iframe.src !== next) iframe.src = next; // reload only when needed
  };

  // Initial
  applyTheme();

  // Observe <html data-theme="...">
  const mo = new MutationObserver((muts) => {
    for (const m of muts) {
      if (m.type === 'attributes' && m.attributeName === 'data-theme') {
        applyTheme();
      }
    }
  });
  mo.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });

  // Optional: support manual dispatch from your theme toggler
  window.addEventListener('themechange', applyTheme, { passive: true });
})();
</script>
